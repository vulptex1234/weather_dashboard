# ぶどう栽培用気象モニタリングシステム要件定義書

## 1. システム概要

### 1.1 目的

- 天気予報 API とセンサーからのデータを組み合わせて、最適なセンサーデータ取得頻度を決定する
- ぶどうの露地栽培における気象条件の急激な変化を早期に検知し、適切な対応を可能にする
- 気象変化に応じてセンサーデータの取得頻度を動的に最適化する
- システム導入による効果
  - ESP32 の通信量を最適化し、バッテリー消費を最小限に抑制
  - 気象変化が予測される重要なタイミングでのデータ取得を確実に実施
  - 不要なデータ取得を削減しつつ、必要なデータの取得精度を維持
  - センサーノードの運用効率の向上と長期的な安定運用の実現

### 1.2 システム構成

- センサーノード：ESP32 + BME280（10 台程度）
  - 開発言語：MicroPython
- 通信方式：Wi-Fi（マルチホップネットワーク）
- データ収集・分析サーバー
- Web ダッシュボード

## 2. 機能要件

### 2.1 天気予報データの取得と分析

- 無料の天気予報 API を使用
- 取得する気象データ
  - 気温
  - 湿度
  - 降水量（予報）
  - 降水強度
  - 風速
- データ取得頻度：1 時間ごと（API の制限に応じて調整可能）
- 気象変化の予測に基づく取得頻度の動的調整

### 2.2 センサーデータの取得

- センサータイプ：BME280
- 測定項目
  - 気温
  - 湿度
  - 気圧
- 取得頻度：天気予報データとセンサーデータに基づいて動的に決定
  - 基本頻度：30 分間隔
  - 気象変化予測時：5 分間隔
  - 緊急時（ゲリラ豪雨予測など）：1 分間隔
  - 気象安定時：1 時間間隔
- 取得頻度の動的更新
  - 天気予報データの変化に応じて即時更新
  - センサーデータの急激な変化を検知した場合の即時更新
  - 各センサーノード個別の取得頻度設定

### 2.3 データ分析と取得頻度の決定

- 天気予報データとセンサーデータの相関分析
- 気象変化の予測に基づく取得頻度の動的調整
  - 機械学習による気象変化予測
  - 過去のデータに基づくパターン分析
- 異常値の検知と警告
- 取得頻度の最適化アルゴリズム
  - バッテリー消費とデータ精度のバランス
  - 気象条件の重要度に基づく重み付け

### 2.4 データ可視化

- Web ダッシュボードによる表示
- 表示形式
  - 時系列グラフ
  - データテーブル
- 表示項目
  - 現在の気象状況
  - 予報データ
  - センサーデータ取得頻度
  - 異常値警告
  - 取得頻度の変更履歴
  - 気象変化予測の信頼度

## 3. 非機能要件

### 3.1 性能要件

- センサーデータ取得頻度の更新：1 時間ごと
- データ表示の更新：リアルタイム
- システム応答時間：5 秒以内

### 3.2 信頼性要件

- システム稼働率：99.9%
- データバックアップ：日次
- エラー発生時の自動リカバリー機能

### 3.3 セキュリティ要件

- センサーノード間の通信の暗号化
- サーバーへのアクセス認証
- データの機密性確保

### 3.4 拡張性要件

- センサーノードの追加が容易な設計
- 新しい気象データの追加に対応可能な設計
- API の変更に対応可能な設計

## 4. 制約条件

### 4.1 技術的制約

- ESP32 の Wi-Fi 通信範囲内でのセンサー配置
- マルチホップネットワークの安定性確保
- バッテリー消費の最適化

### 4.2 運用制約

- 無料の天気予報 API の利用制限への対応
- データ保存期間：1 年間
- メンテナンス頻度：月 1 回

## 5. 今後の課題

### 5.1 検討事項

- 最適なセンサー配置間隔の決定
- センサーの設置高さの最適化
- バッテリー寿命の延伸方法
- 取得頻度の最適化アルゴリズムの改善
- 気象変化予測の精度向上

### 5.2 将来の拡張性

- 他の作物への対応
- 気象データに基づく自動制御システムへの発展
- 機械学習による予測精度の向上
- 取得頻度の最適化アルゴリズムの汎用化
- 複数地域での同時運用への対応
